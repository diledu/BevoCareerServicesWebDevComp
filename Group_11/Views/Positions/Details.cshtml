@model Group_11.Models.Position

@{
    ViewData["Title"] = "Details";
}

<h1>Position Details</h1>

<div>
    <h4>@Model.Title</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Company</dt>
        <dd class="col-sm-10">@Model.Company?.Name</dd>

        <dt class="col-sm-2">Industry</dt>
        <dd class="col-sm-10">
            @string.Join(", ", Model.Company.Industries.Select(i => i.IndustryName))
        </dd>

        <dt class="col-sm-2">Description</dt>
        <dd class="col-sm-10">@Model.Description</dd>

        <dt class="col-sm-2">Deadline</dt>
        <dd class="col-sm-10">@Model.Deadline.ToShortDateString()</dd>

        <dt class="col-sm-2">Type</dt>
        <dd class="col-sm-10">@Model.Type</dd>

        <dt class="col-sm-2">Location</dt>
        <dd class="col-sm-10">@Model.City, @Model.State</dd>

        <dt class="col-sm-2">Majors</dt>
        <dd class="col-sm-10">
            @string.Join(", ", Model.Majors.Select(m => m.MajorName))
        </dd>
    </dl>
</div>

<!--Application List-->
@if (ViewBag.Applications != null && (User.IsInRole("Recruiter") || User.IsInRole("CSO")))
{
    var applications = ViewBag.Applications as List<Group_11.Models.Application>;

    if (applications.Any())
    {
        <h3>Submitted Applications</h3>
        <table class="table table-striped table-bordered mt-3">
            <thead class="table-dark">
                <tr>
                    <th>Student Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Applied On</th>
                    <th>Company</th>
                    <th>Position</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var app in applications)
                {
                    <tr>
                        <td>@app.Student.FullName</td>
                        <td>@app.Student.Email</td>
                        <td>
                            <form asp-action="UpdateStatus" asp-controller="Applications" method="post" class="d-flex">
                                <input type="hidden" name="ApplicationId" value="@app.ApplicationId" />
                                <input type="hidden" name="PositionId" value="@app.Position.PositionId" />
                                <select name="Status" class="form-select form-select-sm me-2">
                                    @foreach (SelectListItem status in ViewBag.StatusList)
                                    {
                                        @if (status.Value == app.Status.ToString())
                                        {
                                            <option value="@status.Value" selected>
                                                @status.Text
                                            </option>
                                        }
                                        else
                                        {
                                            <option value="@status.Value">
                                                @status.Text
                                            </option>
                                        }
                                    }
                                </select>
                                <button type="submit" class="btn btn-sm btn-outline-primary">Update</button>
                            </form>
                        </td>
                        <td>@app.DateTime.ToShortDateString()</td>
                        <td>@app.Position.Company.Name</td>
                        <td>@app.Position.Title</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>No applications submitted for this position.</p>
    }
}

@if (User.IsInRole("Student") && Model.Deadline >= DateTime.Now)
{
    <form asp-controller="Applications" asp-action="Create" method="get">
        <input type="hidden" name="positionId" value="@Model.PositionId" />
        <button type="submit" class="btn btn-primary">Apply</button>
    </form>
}

<div class="mt-3">
    @if((User.IsInRole("Recruiter") && ViewBag.Company == Model.Company.CompanyId) || User.IsInRole("CSO"))
    {
    <a asp-action="Edit" asp-route-id="@Model?.PositionId">Edit</a>
    }
    <a asp-action="Index">Back to List</a>
</div>
